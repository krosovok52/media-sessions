# Windows

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞-—Å–µ—Å—Å–∏—è–º–∏ –Ω–∞ Windows —á–µ—Ä–µ–∑ WinRT SMTC API.

## –û–±–∑–æ—Ä

–ù–∞ Windows –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Windows.Media.Control` WinRT API –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –º–µ–¥–∏–∞-—Å–µ—Å—Å–∏—è–º–∏.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Media Sessions (Rust)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           Windows.Media.Control (WinRT)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Spotify  ‚îÇ  YouTube  ‚îÇ  VLC  ‚îÇ  Firefox  ‚îÇ  Edge      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------|----------|
| **Windows** | 10 1803+ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å SMTC API |
| **Rust** | 1.80+ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è |
| **CMake** | 3.1+ | –î–ª—è —Å–±–æ—Ä–∫–∏ windows-rs –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```toml
[dependencies]
media-sessions = { version = "0.2", features = ["windows"] }
tokio = { version = "1", features = ["full"] }
```

–ò–ª–∏ —Ç–æ–ª—å–∫–æ Windows (–±–µ–∑ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º):

```toml
[dependencies]
media-sessions = { version = "0.2", default-features = false, features = ["windows"] }
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–µ–µ—Ä—ã

### ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|------------|--------|------------|
| **Spotify UWP** | –õ—é–±–∞—è | –ò–∑ Microsoft Store |
| **YouTube** | –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä | Edge, Chrome, Firefox |
| **–Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞** | –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä | –í –±—Ä–∞—É–∑–µ—Ä–µ |
| **SoundCloud** | –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä | –í –±—Ä–∞—É–∑–µ—Ä–µ |
| **Twitch** | –õ—é–±–æ–π –±—Ä–∞—É–∑–µ—Ä | –í –±—Ä–∞—É–∑–µ—Ä–µ |

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|------------|--------|------------|
| **Spotify Desktop** | –õ—é–±–∞—è | –ù—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö |
| **VLC** | 3.0+ | –í–∫–ª—é—á–∏—Ç—å "Show media info" |
| **foobar2000** | 1.6+ | –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç |
| **AIMP** | 4.70+ | –í–∫–ª—é—á–∏—Ç—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö |

### ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|------------|---------|
| **Winamp** | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SMTC |
| **Old –ø–ª–µ–µ—Ä—ã** | –î–æ Windows 10 1803 |

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–µ–µ—Ä–æ–≤

### Spotify Desktop

1. –û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Spotify
2. –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –≤–Ω–∏–∑ –¥–æ "Show Advanced Settings"
3. –í–∫–ª—é—á–∏—Ç—å "Show media information when playing"

### VLC

1. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏
2. –í–∫–ª–∞–¥–∫–∞ "–ü—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç–µ–ª—å"
3. –í–∫–ª—é—á–∏—Ç—å "Show media info on taskbar"

### foobar2000

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `foo_uie_albumlist`
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Advanced ‚Üí Tools ‚Üí Enable media keys

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```rust
use media_sessions::MediaSessions;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let sessions = MediaSessions::new()?;

    if let Some(info) = sessions.current().await? {
        println!("üéµ {} - {}", info.artist(), info.title());
    }

    Ok(())
}
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π

```rust
use media_sessions::{MediaSessions, MediaSessionEvent};
use futures::StreamExt;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let sessions = MediaSessions::new()?;
    let mut stream = sessions.watch().await?;

    while let Some(event) = stream.next().await {
        match event? {
            MediaSessionEvent::MetadataChanged(info) => {
                println!("üéµ –¢–µ–ø–µ—Ä—å: {}", info.display_string());
            }
            MediaSessionEvent::PlaybackStatusChanged(status) => {
                println!("‚ñ∂Ô∏è –°—Ç–∞—Ç—É—Å: {:?}", status);
            }
            _ => {}
        }
    }

    Ok(())
}
```

### 3. CLI —É—Ç–∏–ª–∏—Ç–∞

```rust
use media_sessions::{MediaSessions, PlaybackStatus};

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let sessions = MediaSessions::new()?;

    if let Some(info) = sessions.current().await? {
        let icon = match info.playback_status {
            PlaybackStatus::Playing => "‚ñ∂Ô∏è",
            PlaybackStatus::Paused => "‚è∏Ô∏è",
            PlaybackStatus::Stopped => "‚èπÔ∏è",
            _ => "‚è≥",
        };

        println!("‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó");
        println!("‚ïë         Now Playing                    ‚ïë");
        println!("‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£");
        println!("‚ïë {} {}", icon, info.display_string());
        if let Some(album) = &info.album {
            println!("‚ïë üíø {}", album);
        }
        println!("‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù");
    }

    Ok(())
}
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è SMTC API

### –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

| –§—É–Ω–∫—Ü–∏—è | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|---------|
| **Volume control** | SMTC –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø |
| **Repeat mode** | –ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ API |
| **Shuffle** | –ù–µ –¥–æ—Å—Ç—É–ø–Ω–æ —á–µ—Ä–µ–∑ API |
| **Artwork** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø |

### –û–±—Ö–æ–¥ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

–î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ API –ø–ª–µ–µ—Ä–æ–≤:

```rust
// –î–ª—è Spotify –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Spotify Web API
// –î–ª—è VLC - HTTP interface
// –î–ª—è foobar2000 - COM interface
```

## Troubleshooting

### –ü–ª–µ–µ—Ä –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```rust
let sessions = MediaSessions::new()?;
let info = sessions.current().await?;

match info {
    Some(info) => println!("Found: {}", info.display_string()),
    None => println!("No active session"),
}
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–ª–µ–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–ª–µ–µ—Ä–∞ (—Å–º. –≤—ã—à–µ)
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –≤–µ–±-–ø–ª–µ–µ—Ä–æ–≤

### –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```rust
match MediaSessions::new() {
    Ok(sessions) => { /* OK */ }
    Err(MediaError::NotSupported(platform)) => {
        eprintln!("Platform {} not supported", platform);
    }
    Err(e) => {
        eprintln!("Error: {}", e);
    }
}
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Windows 10 1803+
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### CMake –æ—à–∏–±–∫–∏ —Å–±–æ—Ä–∫–∏

**–û—à–∏–±–∫–∞:**

```
error: failed to run custom build command for `windows-rs`
```

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CMake
winget install Kitware.CMake

# –ò–ª–∏ —Å–∫–∞—á–∞—Ç—å —Å https://cmake.org/download/

# –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
cargo clean
cargo build
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|----------|-------|------------|
| `current()` | ~350 ns | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ |
| `watch()` first event | ~600 ns | –ü–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ |
| Event throughput | ~850/sec | –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |

## –°–º. —Ç–∞–∫–∂–µ

- **[macOS](platforms/macos.md)** ‚Äî macOS —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **[Linux](platforms/linux.md)** ‚Äî Linux —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](../guides/error-handling.md)** ‚Äî –ì–∞–π–¥ –ø–æ –æ—à–∏–±–∫–∞–º
