# macOS

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–¥–∏–∞-—Å–µ—Å—Å–∏—è–º–∏ –Ω–∞ macOS —á–µ—Ä–µ–∑ MediaRemote.framework.

## –û–±–∑–æ—Ä

–ù–∞ macOS –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π `MediaRemote.framework` –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –º–µ–¥–∏–∞-—Å–µ—Å—Å–∏—è–º–∏.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Media Sessions (Rust)                      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ          MediaRemote.framework (Private)                ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Spotify  ‚îÇ  Apple Music  ‚îÇ  VLC  ‚îÇ  Safari  ‚îÇ  Chrome  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------|----------|
| **macOS** | 12.0+ (Monterey) | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è |
| **Rust** | 1.80+ | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–∞—è –≤–µ—Ä—Å–∏—è |
| **Xcode** | 13.0+ | –î–ª—è —Å–±–æ—Ä–∫–∏ |

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```toml
[dependencies]
media-sessions = { version = "0.2", features = ["macos"] }
tokio = { version = "1", features = ["full"] }
```

–ò–ª–∏ —Ç–æ–ª—å–∫–æ macOS:

```toml
[dependencies]
media-sessions = { version = "0.2", default-features = false, features = ["macos"] }
```

## Permissions (–†–∞–∑—Ä–µ—à–µ–Ω–∏—è)

### Accessibility Permissions

–î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø Accessibility.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**

1. **System Preferences** ‚Üí **Privacy & Security** ‚Üí **Accessibility**
2. –ù–∞–∂–º–∏—Ç–µ **+** –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à —Ç–µ—Ä–º–∏–Ω–∞–ª –∏–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Privacy & Security > Accessibility                    ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ ‚òë Terminal                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚òë Visual Studio Code                             ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ ‚òê Your App                                       ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                                                        ‚îÇ
‚îÇ  [+]  [-]                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```rust
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
fn check_accessibility() -> bool {
    #[cfg(target_os = "macos")]
    {
        use objc2_foundation::NSBundle;
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ AXIsProcessTrusted
        unsafe { macos_accessibility::AXIsProcessTrusted() }
    }
    #[cfg(not(target_os = "macos"))]
    {
        true
    }
}
```

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–µ–µ—Ä—ã

### ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|------------|--------|------------|
| **Spotify** | –õ—é–±–∞—è | Desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **Apple Music** | –õ—é–±–∞—è | –°–∏—Å—Ç–µ–º–Ω—ã–π –ø–ª–µ–µ—Ä |
| **YouTube** | Safari/Chrome | –í –±—Ä–∞—É–∑–µ—Ä–µ |
| **SoundCloud** | Safari/Chrome | –í –±—Ä–∞—É–∑–µ—Ä–µ |
| **VLC** | 3.0+ | –° –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ media keys |
| **IINA** | –õ—é–±–∞—è | –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ø–ª–µ–µ—Ä |

### ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|------------|--------|------------|
| **Firefox** | –õ—é–±–∞—è | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| **QuickTime** | –õ—é–±–∞—è | –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å |

### ‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è

| –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –ü—Ä–∏—á–∏–Ω–∞ |
|------------|---------|
| **Old –ø–ª–µ–µ—Ä—ã** | –î–æ macOS 12 |
| **–ù–µ-MPRIS** | –ë–µ–∑ MediaRemote |

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–ª–µ–µ—Ä–æ–≤

### VLC

1. VLC ‚Üí Preferences
2. Show All ‚Üí Advanced
3. Enable "Control Center" integration

### Firefox

1. –û—Ç–∫—Ä—ã—Ç—å `about:config`
2. –í–∫–ª—é—á–∏—Ç—å `media.hardwaremediakeys.enabled`

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```rust
use media_sessions::MediaSessions;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let sessions = MediaSessions::new()?;

    if let Some(info) = sessions.current().await? {
        println!("üéµ {} - {}", info.artist(), info.title());
        println!("üíø {}", info.album());
    }

    Ok(())
}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions

```rust
use media_sessions::MediaSessions;

fn check_permissions() -> Result<(), Box<dyn std::error::Error>> {
    #[cfg(target_os = "macos")]
    {
        println!("üîí Checking Accessibility permissions...");
        
        // –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Å—Å–∏–∏
        match MediaSessions::new() {
            Ok(_) => println!("‚úÖ Permissions OK"),
            Err(e) => {
                eprintln!("‚ùå Error: {}", e);
                eprintln!("üí° Please grant Accessibility permissions:");
                eprintln!("   System Preferences ‚Üí Privacy & Security ‚Üí Accessibility");
                return Err(e.into());
            }
        }
    }
    
    Ok(())
}

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    check_permissions()?;
    
    let sessions = MediaSessions::new()?;
    
    if let Some(info) = sessions.current().await? {
        println!("üéµ {} - {}", info.display_string());
    }
    
    Ok(())
}
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–±—ã—Ç–∏–π

```rust
use media_sessions::{MediaSessions, MediaSessionEvent};
use futures::StreamExt;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    let sessions = MediaSessions::builder()
        .debounce_duration(std::time::Duration::from_millis(500))
        .build()?;
    
    let mut stream = sessions.watch().await?;
    
    while let Some(event) = stream.next().await {
        match event? {
            MediaSessionEvent::MetadataChanged(info) => {
                println!("üéµ –¢–µ–ø–µ—Ä—å: {}", info.display_string());
            }
            MediaSessionEvent::PlaybackStatusChanged(status) => {
                println!("‚ñ∂Ô∏è –°—Ç–∞—Ç—É—Å: {:?}", status);
            }
            _ => {}
        }
    }
    
    Ok(())
}
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è MediaRemote

### –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

| –§—É–Ω–∫—Ü–∏—è | –ü—Ä–∏—á–∏–Ω–∞ |
|---------|---------|
| **Volume control** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø |
| **Repeat mode** | –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Shuffle** | –ß–∞—Å—Ç–∏—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è |
| **Artwork** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø |

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- MediaRemote ‚Äî **–ø—Ä–∏–≤–∞—Ç–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫** Apple
- API –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è –≤ –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö macOS
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç Accessibility permissions

## Troubleshooting

### –ü–ª–µ–µ—Ä –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
log show --predicate 'eventMessage contains "NowPlaying"' --last 1m
```

**–†–µ—à–µ–Ω–∏–µ:**

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–ª–µ–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Accessibility permissions
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø–ª–µ–µ—Ä

### –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞

```
Error: Backend { platform: "macos", message: "Access denied" }
```

**–†–µ—à–µ–Ω–∏–µ:**

1. System Preferences ‚Üí Privacy & Security ‚Üí Accessibility
2. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à —Ç–µ—Ä–º–∏–Ω–∞–ª/IDE
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### –û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏

```
error: failed to run custom build command for `objc2`
```

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Xcode Command Line Tools
xcode-select --install

# –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
cargo clean
cargo build
```

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –û–ø–µ—Ä–∞—Ü–∏—è | –í—Ä–µ–º—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|----------|-------|------------|
| `current()` | ~1.8 ms | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ |
| `watch()` first event | ~2.5 ms | –ü–µ—Ä–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ |
| Event throughput | ~400/sec | –ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å |

## –°–º. —Ç–∞–∫–∂–µ

- **[Windows](platforms/windows.md)** ‚Äî Windows —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **[Linux](platforms/linux.md)** ‚Äî Linux —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- **[–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](../guides/error-handling.md)** ‚Äî –ì–∞–π–¥ –ø–æ –æ—à–∏–±–∫–∞–º
